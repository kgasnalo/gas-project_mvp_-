# 📊 スプレッドシート内ダッシュボード（Phase 4-1）

**バージョン:** 1.0
**実装日:** 2025-11-25
**ステータス:** ✅ 実装完了

---

## 📋 概要

Phase 4-1で実装したスプレッドシート内ダッシュボードは、採用活動における候補者の承諾可能性を可視化し、採用担当者が1枚のダッシュボードで全候補者の状況を把握できるようにします。

### 設計思想

```
【目標】
採用担当者が1枚のダッシュボードで、
全候補者の承諾可能性を把握し、
適切なアクションを即座に判断できる

【原則】
✅ 人の手を介さない自動更新
✅ Engagement_Logを単一の真実の情報源（SSOT）とする
✅ QUERY関数で常に最新データを表示
✅ 条件付き書式で重要情報を強調
✅ 視覚的に分かりやすいチャート
```

---

## 🎯 主要機能

### 1. 自動集計ビュー

**Dashboard_Dataシート**が中間データとして以下を自動集計:

| セクション | 内容 | 更新方法 |
|-----------|------|---------|
| 最新承諾可能性 | 候補者別の最新承諾可能性 | QUERY関数で自動 |
| フェーズ別スコア推移 | 各フェーズのスコア推移 | QUERY関数で自動 |
| AI予測 vs 人間の直感 | AI予測と人間の直感の比較 | QUERY関数で自動 |
| 懸念事項集計 | 懸念事項の出現回数 | QUERY関数で自動 |
| ステータス分布 | 候補者ステータス分布 | COUNTIF関数で自動 |

### 2. KPIサマリー

以下のKPIを自動計算:

- **総候補者数**: Engagement_Logから自動カウント
- **平均承諾可能性**: 全候補者の平均スコア
- **高確率候補者数**: 80点以上の候補者数
- **要注意候補者数**: 60点未満の候補者数
- **本日の新規記録**: 今日追加されたデータ件数

### 3. 候補者ランキング

承諾可能性順に候補者を表示:

- 順位
- 候補者ID
- 承諾可能性（色分け表示）
- フェーズ
- 最終更新日
- コアモチベーション

**条件付き書式:**
- 🟢 80点以上: 緑色（高確率）
- 🟡 60-79点: 黄色（標準）
- 🔴 60点未満: 赤色（要注意）

### 4. AI予測 vs 人間の直感

AI予測と人間の直感の乖離を分析:

- 候補者ID
- AI予測
- 人間の直感
- 乖離
- 状態判定（✅一致 / ⚠️やや乖離 / ❌大きく乖離）

**条件付き書式:**
- 🟠 乖離20点以上: オレンジ色（大きく乖離）

### 5. チャート

以下の4種類のチャートを自動生成:

#### 1. 候補者別承諾可能性（棒グラフ）
- 配置: H11:M25
- データソース: Dashboard_Data!B13:C27
- 候補者別の承諾可能性を横棒グラフで表示

#### 2. フェーズ別スコア推移（折れ線グラフ）
- 配置: H27:M45
- データソース: Dashboard_Data!G2:K6
- 各候補者のフェーズごとのスコア推移を表示

#### 3. AI予測 vs 人間の直感（散布図）
- 配置: H47:M65
- データソース: Dashboard_Data!N2:O20
- AI予測と人間の直感の関係を散布図で表示
- トレンドライン付き

#### 4. 候補者ステータス分布（円グラフ）
- 配置: A52:F65
- データソース: Dashboard_Data!U2:V5
- 候補者のステータス分布を円グラフで表示
- ドーナツグラフ形式

---

## 📂 ファイル構成

```
gas-project_mvp_-/
├── DashboardSetup.gs          # Dashboard_DataとDashboardシートの作成
├── DashboardCharts.gs         # チャート作成機能
├── Config.gs (設定値).js      # 設定値（DASHBOARD_DATA追加）
├── DASHBOARD_IMPLEMENTATION_GUIDE.md  # 実装ガイド
└── DASHBOARD_README.md        # このファイル
```

---

## 🚀 使用方法

### セットアップ（初回のみ）

1. **スクリプトエディタを開く**
   - 拡張機能 > Apps Script

2. **セットアップ関数を実行**
   ```javascript
   setupDashboardPhase4()
   ```

3. **完了確認**
   - Dashboard_Dataシートが作成される
   - Dashboardシートが作成される
   - チャートが自動生成される

詳細は [DASHBOARD_IMPLEMENTATION_GUIDE.md](./DASHBOARD_IMPLEMENTATION_GUIDE.md) を参照してください。

### 日常的な使用

1. **Engagement_Logにデータを追加**
   - 通常通り、Engagement_Logに承諾可能性データを入力

2. **Dashboardを開く**
   - Dashboardシートを開くだけで最新データが自動表示

3. **データの自動更新**
   - QUERY関数により、Engagement_Logのデータ変更が即座に反映

---

## 🔧 カスタマイズ

### KPI項目の追加

`DashboardSetup.gs` の `setupDashboardKPIs()` 関数を編集:

```javascript
const kpiData = [
  ['総候補者数', '=COUNTA(UNIQUE(Engagement_Log!B:B))-1'],
  ['平均承諾可能性', '=ROUND(AVERAGE(Dashboard_Data!B:B),1) & "点"'],
  // 新しいKPIを追加
  ['今週の面接数', '=COUNTIFS(Engagement_Log!D:D,">="&TODAY()-7)']
];
```

### チャートの色変更

`DashboardCharts.gs` の各チャート作成関数でオプションを編集:

```javascript
.setOption('colors', ['#4285f4']) // ← 色を変更
```

### 条件付き書式の閾値変更

`DashboardSetup.gs` の `setupDashboardConditionalFormats()` 関数を編集:

```javascript
// 例: 高確率の閾値を90点に変更
.whenNumberGreaterThanOrEqualTo(90) // ← 90に変更
```

---

## 📊 データフロー

```
┌─────────────────────────────────────────────┐
│ Engagement_Log（データソース）               │
│ - candidate_id                              │
│ - acceptance_rate_final                      │
│ - contact_type                               │
│ - core_motivation                            │
│ - top_concern                                │
└──────────────┬──────────────────────────────┘
               │ QUERY関数で自動集計
               ▼
┌─────────────────────────────────────────────┐
│ Dashboard_Data（中間データ）                 │
│ - 最新承諾可能性（A1:E100）                  │
│ - フェーズ別スコア推移（G1:K100）             │
│ - AI予測 vs 人間の直感（M1:P100）            │
│ - 懸念事項集計（R1:S20）                     │
│ - ステータス分布（U1:V5）                    │
└──────────────┬──────────────────────────────┘
               │ 参照・計算
               ▼
┌─────────────────────────────────────────────┐
│ Dashboard（メインダッシュボード）             │
│ - KPIサマリー                                │
│ - 候補者ランキング                           │
│ - AI予測 vs 人間の直感                       │
│ - チャート（4種類）                          │
└─────────────────────────────────────────────┘
```

---

## 🐛 トラブルシューティング

### よくある問題

| 問題 | 原因 | 対処法 |
|-----|------|-------|
| QUERY関数でエラー | データが存在しない | Engagement_Logにデータを追加 |
| チャートが表示されない | Dashboard_Dataが空 | setupDashboardPhase4()を再実行 |
| 条件付き書式が機能しない | ルールが未設定 | setupDashboardConditionalFormats()を再実行 |
| データが更新されない | QUERY関数のエラー | Engagement_Logの列番号を確認 |

詳細は [DASHBOARD_IMPLEMENTATION_GUIDE.md](./DASHBOARD_IMPLEMENTATION_GUIDE.md) の「トラブルシューティング」セクションを参照してください。

---

## 📈 パフォーマンス

### QUERY関数の最適化

- **データ範囲の限定**: `Engagement_Log!A:U` のように範囲を指定
- **WHERE句の活用**: 不要なデータを除外
- **LIMIT句の活用**: 表示件数を制限

### チャートの最適化

- **データ範囲の限定**: 必要最小限のデータのみ使用
- **チャート数の制限**: 4つまでに制限（パフォーマンス考慮）

---

## 🔒 セキュリティ

### データアクセス

- Dashboardシートは**読み取り専用**として使用
- データの編集はEngagement_Logで実施
- Dashboard_Dataは非表示にすることを推奨

### 権限管理

- スプレッドシートの共有権限を適切に設定
- 閲覧専用ユーザーには編集権限を与えない

---

## 🚧 今後の拡張予定

以下の機能追加を検討中:

- [ ] **週次・月次レポート自動生成**
- [ ] **アラート機能**: 承諾可能性が低下した候補者を通知
- [ ] **比較分析**: 前週/前月との比較
- [ ] **予測分析**: 承諾可能性の将来予測
- [ ] **エクスポート機能**: PDFやExcelへのエクスポート

---

## 📝 変更履歴

| 日付 | バージョン | 変更内容 |
|-----|-----------|---------|
| 2025-11-25 | 1.0 | 初回リリース（Phase 4-1） |

---

## 📞 サポート

問題や質問がある場合は、以下を確認してください:

1. [DASHBOARD_IMPLEMENTATION_GUIDE.md](./DASHBOARD_IMPLEMENTATION_GUIDE.md)
2. スクリプトエディタのログ（表示 > ログ）
3. プロジェクトのIssueセクション

---

**Phase 4-1: スプレッドシート内ダッシュボード実装完了 🎉**
