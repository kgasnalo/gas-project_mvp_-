# 📊 スプレッドシート内ダッシュボード実装ガイド

**Version:** 1.0
**Date:** 2025-11-25
**Phase:** 4-1（Week 7）
**実装時間:** 5-10分

---

## 📋 目次

1. [概要](#概要)
2. [前提条件](#前提条件)
3. [実装手順](#実装手順)
4. [実装内容の確認](#実装内容の確認)
5. [トラブルシューティング](#トラブルシューティング)
6. [完了チェックリスト](#完了チェックリスト)

---

## 概要

このガイドは、Phase 4-1で実装するスプレッドシート内ダッシュボードの自動セットアップ手順を説明します。

### 作成されるシート

| シート名 | 役割 |
|---------|------|
| **Dashboard_Data** | 中間データ（QUERY関数の結果を格納） |
| **Dashboard** | メインダッシュボード（KPI、ランキング、チャート） |

### 実装される機能

- ✅ **自動集計**: QUERY関数による最新データの自動取得
- ✅ **条件付き書式**: ヒートマップ、要注意候補者の強調
- ✅ **チャート**: 棒グラフ、折れ線グラフ、散布図、円グラフ
- ✅ **KPIサマリー**: 総候補者数、平均承諾可能性、高確率候補者数など

---

## 前提条件

### 必須シートの確認

以下のシートが存在することを確認してください:

- ✅ **Engagement_Log**: 承諾可能性データが入力されている
- ✅ **Evaluation_Log**: 評価データが入力されている
- ✅ **Candidates_Master**: 候補者マスターデータが存在する

### テストデータの確認

Engagement_Logに**最低5件以上**のデータが存在することを確認してください。

データがない場合は、以下のスクリプトを実行してテストデータを生成できます:

```javascript
// Google Apps Scriptエディタで実行
function generateTestData() {
  // TestDataGenerator.gsのcreateTestData()を実行
  createTestData();
}
```

---

## 実装手順

### ステップ1: Google Apps Scriptエディタを開く

1. スプレッドシートを開く
2. メニューバーから **拡張機能 > Apps Script** をクリック
3. スクリプトエディタが開くことを確認

### ステップ2: スクリプトファイルの確認

以下のファイルが存在することを確認:

- ✅ `DashboardSetup.gs`
- ✅ `DashboardCharts.gs`
- ✅ `Config.gs (設定値).js`

### ステップ3: ダッシュボードセットアップを実行

1. スクリプトエディタで `DashboardSetup.gs` を開く
2. 関数選択ドロップダウンから **`setupDashboardPhase4`** を選択
3. **▶ 実行** ボタンをクリック

![実行手順](https://i.imgur.com/example.png)

### ステップ4: 権限の承認（初回のみ）

初回実行時、以下のダイアログが表示されます:

1. **「権限を確認」** をクリック
2. Googleアカウントを選択
3. **「詳細」** をクリック
4. **「(プロジェクト名)に移動」** をクリック
5. **「許可」** をクリック

### ステップ5: 実行完了を確認

実行が完了すると、以下のメッセージが表示されます:

```
✅ ダッシュボードセットアップ完了

以下のシートが作成されました:
- Dashboard_Data (中間データ)
- Dashboard (メインダッシュボード)

Dashboardシートを開いてください。
```

### ステップ6: Dashboardシートを確認

1. スプレッドシートに戻る
2. **Dashboard** シート（一番左）を開く
3. 以下のセクションが表示されることを確認:
   - 📊 採用ダッシュボード（ヘッダー）
   - 【KPIサマリー】
   - 【候補者別承諾可能性ランキング】
   - 【AI予測 vs 人間の直感】
   - チャート（4種類）

---

## 実装内容の確認

### ✅ Dashboard_Dataシート

以下のセクションが作成されていることを確認:

| セクション | 列範囲 | 内容 |
|-----------|--------|------|
| 最新承諾可能性 | A1:E100 | 候補者別の最新承諾可能性データ |
| フェーズ別スコア推移 | G1:K100 | 各フェーズのスコア推移 |
| AI予測 vs 人間の直感 | M1:P100 | AI予測と人間の直感の比較 |
| 懸念事項集計 | R1:S20 | 懸念事項の出現回数 |
| ステータス分布 | U1:V5 | 候補者ステータス分布データ |

### ✅ Dashboardシート

以下のセクションが作成されていることを確認:

| セクション | 行範囲 | 内容 |
|-----------|--------|------|
| ヘッダー | A1:F2 | タイトルと最終更新日時 |
| KPIサマリー | A4:F9 | 総候補者数、平均承諾可能性など |
| 候補者ランキング | A11:F30 | 承諾可能性順のランキング |
| AI予測 vs 人間の直感 | A32:E50 | AI予測と人間の直感の比較 |

### ✅ チャート

以下のチャートが作成されていることを確認:

1. **候補者別承諾可能性（棒グラフ）** - H11:M25
2. **フェーズ別スコア推移（折れ線グラフ）** - H27:M45
3. **AI予測 vs 人間の直感（散布図）** - H47:M65
4. **候補者ステータス分布（円グラフ）** - A52:F65

### ✅ 条件付き書式

以下の条件付き書式が設定されていることを確認:

- **承諾可能性（C13:C27）**:
  - 🟢 80点以上: 緑色
  - 🟡 60-79点: 黄色
  - 🔴 60点未満: 赤色

- **乖離（D34:D48）**:
  - 🟠 20点以上: オレンジ色

---

## トラブルシューティング

### 問題1: QUERY関数でエラーが表示される

**症状:**
```
#REF! エラー
```

**原因:**
- Engagement_Logにデータが存在しない
- 列番号が間違っている

**対処法:**
1. Engagement_Logシートを開く
2. データが入力されていることを確認
3. データがない場合は、TestDataGeneratorを実行

### 問題2: チャートが表示されない

**症状:**
- チャートエリアが空白

**原因:**
- Dashboard_Dataにデータが存在しない
- チャート作成スクリプトがエラーになっている

**対処法:**
1. スクリプトエディタを開く
2. **表示 > ログ** を確認
3. エラーメッセージを確認
4. 必要に応じて `setupDashboardCharts()` を再実行

### 問題3: 条件付き書式が機能しない

**症状:**
- セルの色が変わらない

**原因:**
- 条件付き書式のルールが設定されていない
- データ型が間違っている

**対処法:**
1. Dashboardシートを開く
2. セルを選択
3. **表示形式 > 条件付き書式** を確認
4. ルールが存在することを確認
5. 必要に応じて `setupDashboardConditionalFormats()` を再実行

### 問題4: 実行時にエラーが発生する

**症状:**
```
TypeError: Cannot read property 'getRange' of null
```

**原因:**
- シートが存在しない
- シート名が間違っている

**対処法:**
1. スプレッドシートで必須シート（Engagement_Log、Evaluation_Log）が存在することを確認
2. Config.gsでシート名が正しいことを確認
3. スクリプトを再実行

---

## 完了チェックリスト

実装完了後、以下の項目をチェックしてください:

### Dashboard_Dataシート

- [ ] A列に候補者IDが表示されている
- [ ] B列に承諾可能性（数値）が表示されている
- [ ] G列に候補者IDが表示されている
- [ ] H-K列にフェーズ別スコアが表示されている
- [ ] M列に候補者IDが表示されている
- [ ] N-P列にAI予測、人間の直感、乖離が表示されている
- [ ] R列に懸念事項が表示されている
- [ ] U列にステータスが表示されている

### Dashboardシート

- [ ] タイトル「📊 採用ダッシュボード」が表示されている
- [ ] 最終更新日時が自動表示されている
- [ ] KPIサマリーに数値が表示されている
- [ ] 候補者ランキングに候補者データが表示されている
- [ ] ランキングのC列が色分けされている（緑/黄/赤）
- [ ] AI予測 vs 人間の直感にデータが表示されている
- [ ] 乖離が大きい行がオレンジ色になっている

### チャート

- [ ] 候補者別承諾可能性（棒グラフ）が表示されている
- [ ] フェーズ別スコア推移（折れ線グラフ）が表示されている
- [ ] AI予測 vs 人間の直感（散布図）が表示されている
- [ ] 候補者ステータス分布（円グラフ）が表示されている

### 動作確認

- [ ] Engagement_Logに新しいデータを追加
- [ ] Dashboardのデータが自動更新される
- [ ] KPIサマリーの数値が変わる
- [ ] ランキングが更新される
- [ ] チャートが更新される

---

## 次のステップ

ダッシュボード実装が完了したら、以下を実施してください:

1. **定期的なデータ更新**
   - Engagement_Logに最新データを入力
   - Dashboardが自動更新されることを確認

2. **チームへの共有**
   - スプレッドシートをチームメンバーと共有
   - Dashboardシートの使い方を説明

3. **カスタマイズ**
   - 必要に応じてKPI項目を追加
   - チャートの色やレイアウトを調整

---

## サポート

問題が解決しない場合は、以下を確認してください:

- **ログの確認**: スクリプトエディタで **表示 > ログ** を確認
- **実行ログの確認**: スクリプトエディタで **表示 > 実行数** を確認
- **エラーメッセージ**: エラーメッセージをコピーして検索

---

**以上でダッシュボード実装は完了です！🎉**
